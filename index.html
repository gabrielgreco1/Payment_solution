<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leitor de Pix e CNPJ</title>

    <style type="text/css">
        *{
        }
        #filecontents {
            border: double;
            overflow-y: scroll;
            height: 250px;
        }

        #validacao {
            margin-top: 10px;
            border: double;
            overflow-y: scroll;
            height: 150px;
        }

        #valida {
            font-size: 20px;
        }

        #roda {
            width: 50%;
            height: 50%;
        }
    </style>
</head>

<body>
    <main>
        <label for="txtfiletoread">Selecione o arquivo que será lido</label>
        <input type="file" name="File" id="txtfiletoread">
        <div id="filecontents"></div>
        <label for="validacao" id="valida">Validação:</label>
        <button id="Roda">Validar</button>
        <div id="validacao"></div>
    </main>

    <script>
        var fileReader;
        var fileContentes = document.getElementById("filecontents");
        var validacao = document.getElementById("validacao");

        window.onload = function () {
            if (window.File && window.FileReader && window.FileList && window.Blob) {
                var fileSelected = document.getElementById("txtfiletoread");

                fileSelected.addEventListener('change', function (e) {
                    var fileExtension = /text.*/;
                    var fileTobeRead = fileSelected.files[0];

                    if (fileTobeRead.type.match(fileExtension)) {
                        fileReader = new FileReader();

                        fileReader.onload = function (e) {
                            fileContentes.innerText = fileReader.result;
                        }

                        fileReader.readAsText(fileTobeRead);
                    } else {
                        alert("Por favor selecione arquivo texto")
                    }

                }, false);
            } else {
                alert("Arquivo(s) não suportado(s)")
            }
        }


        const btn = document.getElementById("Roda");
        btn.addEventListener("click", function () {
            const fileContent = fileReader.result;
            let validacaoHtml = "";
            const lines = fileContent.split(/\r?\n/);
            for (let i = 2; i < lines.length; i += 2) {
                const line1 = lines[i];
                if (line1 && line1.length >= 218) {
                    const interval1 = line1.substring(203, 218).trim();
                    const line2 = lines[i + 1];
                    if (line2 && line2.length >= 160) {
                        const interval2 = line2.substring(127, 160).trim();
                        validacaoHtml += interval1 + " " + interval2 + "<br>";
                    }
                    
                }
            }
            const validacao = document.getElementById("validacao");
            validacao.innerHTML = validacaoHtml;
        });


    </script>
</body>

</html>
